<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en-gb">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Hello Arty - Part 1 | Project F</title>

<meta property='og:title' content='Hello Arty - Part 1 - Project F'>
<meta property='og:description' content='People who are really serious about software should make their own hardware.
Alan Kay, Creative Think seminar, 1982
 This three-part tutorial provides a quick introduction to FPGA development with SystemVerilog and the Digilent Arty A7 board. No prior experience of FPGA development is required, but basic knowledge of programming concepts is assumed. If you can write a simple program in Arduino, Python, or JavaScript, then you shouldn&rsquo;t have any trouble.'>
<meta property='og:url' content='https://projectf.io/posts/hello-arty-1/'>
<meta property='og:site_name' content='Project F'>
<meta property='og:type' content='article'><meta property='og:image' content='https://projectf.io/img/arty-board-card.jpg'><meta property='article:published_time' content='2020-04-24T00:00:00Z'/><meta property='article:modified_time' content='2020-04-24T00:00:00Z'/><meta name='twitter:card' content='summary_large_image'><meta name='twitter:site' content='@WillFlux'><meta name='twitter:creator' content='@WillFlux'>


<link href="https://projectf.io/index.xml" rel="alternate" type="application/rss+xml" title="Project F" />

<link rel="stylesheet" href="/css/style.css"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="https://projectf.io/posts/hello-arty-1/">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
<section class="section">
  <div class="container">
    <nav id="nav-main" class="nav">
      <div id="nav-name" class="nav-left">
        <a id="nav-anchor" class="nav-item" href="https://projectf.io">
          <h1 id="nav-heading" class="title is-4">Project F</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav id="nav-items" class="nav-item level is-mobile"><a class="level-item" aria-label="github" href='https://github.com/projf'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="twitter" href='https://twitter.com/WillFlux'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="rss" href='/index.xml'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      
      <div class="nav-left"><a class="nav-item" href="/tags/cookbook">
          <h2 class="title is-5">Cookbook</h2>
        </a><a class="nav-item" href="/tags/explore">
          <h2 class="title is-5">Explore</h2>
        </a><a class="nav-item" href="/tags/tools">
          <h2 class="title is-5">Tools</h2>
        </a></div>
      

      
    </nav>

  </div>
  <script src="/js/navicon-shift.js"></script>
</section>
<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="/tags/explore/">#explore</a>




      
    </div>
    <h2 class="subtitle is-6">April 24, 2020</h2>
    <h1 class="title">Hello Arty - Part 1</h1>
    
    <div class="content">
      <blockquote>
<p>People who are really serious about software should make their own hardware.<br>
<em>Alan Kay, <a href="https://www.folklore.org/StoryView.py?project=Macintosh&amp;story=Creative_Think.txt">Creative Think seminar, 1982</a></em></p>
</blockquote>
<p>This three-part tutorial provides a quick introduction to FPGA development with <strong>SystemVerilog</strong> and the <strong>Digilent Arty A7</strong> board. No prior experience of FPGA development is required, but basic knowledge of programming concepts is assumed. If you can write a simple program in Arduino, Python, or JavaScript, then you shouldn&rsquo;t have any trouble.</p>
<p>I find working with FPGAs gives me a sense of delight so often lacking in modern software development. There&rsquo;s something profoundly satisfying about designing at the hardware level, be it drawing graphics on a screen, producing sound from a speaker, or even implementing your own arcade game from scratch. I hope you find this tutorial useful and have fun experimenting with FPGAs.</p>
<p><em>Revised 04-May-2020. Feedback to <a href="https://twitter.com/WillFlux">@WillFlux</a> is most welcome.</em></p>
<h3 id="requirements">Requirements</h3>
<p>For this series, we are using the <a href="https://reference.digilentinc.com/reference/programmable-logic/arty-a7/start">Digilent Arty A7-35T</a>, a $130 dev board based on a <a href="https://www.xilinx.com/products/silicon-devices/fpga/artix-7.html">Xilinx Artix-7 FPGA</a>. This board is widely available and supports Xilinx&rsquo;s latest Vivado software, which runs on Linux and Windows 10.</p>
<p>For this three-part series you need:</p>
<ol>
<li><a href="https://reference.digilentinc.com/reference/programmable-logic/arty-a7/start">Digilent Arty A7-35T</a></li>
<li>Micro USB cable to program and power the Arty board</li>
<li><a href="https://www.xilinx.com/support/documentation-navigation/see-all-versions.html?xlnxproducttypes=Design%20Tools&amp;xlnxdocumentid=UG973">Xilinx Vivado</a> (2019 or later) installed<br>
Linux users need to remember to install cable drivers after running setup</li>
<li><a href="https://reference.digilentinc.com/vivado/installing-vivado/start#installing_digilent_board_files">Digilent board files</a></li>
</ol>
<p><em>The original Arty (without the A7) is the same physical board so you can use that too.</em></p>
<h3 id="source">Source</h3>
<p>All the designs featured in this tutorial are available in the <a href="https://github.com/projf/projf-explore/tree/master/hello-arty">Exploring FPGAs repo</a>. Look out for the <strong>[src]</strong> links throughout the post for links to the relevant files.</p>
<h2 id="hello-world-with-systemverilog--vivado">Hello World with SystemVerilog &amp; Vivado</h2>
<p>We&rsquo;re going to start with the traditional dev board &ldquo;hello, world&rdquo;: using simple logic to control the green LEDs on our board. In part 2 (coming soon) we&rsquo;ll move on to clocks, counting, and pulse width modulation.</p>
<h3 id="terminology">Terminology</h3>
<p>Before we dive into creating our first project, I should explain a couple of terms:</p>
<ul>
<li><strong>SystemVerilog</strong> is a hardware description language (<strong>HDL</strong>) that allows you to express your design at a (reasonably) high level instead of directly describing logic gates (AND, OR, NOT). This is roughly analogous to how C lets you express your software design at a higher level than assembly language. Other HDLs include <a href="https://en.wikipedia.org/wiki/VHDL">VHDL</a>, <a href="https://spinalhdl.github.io/SpinalDoc-RTD/">SpinalHDL</a>, and <a href="https://github.com/nmigen/nmigen">nMigen</a>.</li>
<li><strong>Vivado</strong> is the FPGA development suite from <strong>Xilinx</strong>. It includes everything you need to write SystemVerilog and program a Xilinx FPGA. There&rsquo;s no getting around the fact it&rsquo;s a monster, requiring around 20 GiB of disk space. Thankfully it has a no-cost version and is reasonably intuitive once you&rsquo;ve played with it for a little while. Vivado is available for Windows and Linux (Ubuntu RHEL/CentOS, &amp; SUSE), but not for macOS.</li>
</ul>
<h3 id="the-arty-board">The Arty Board</h3>
<p><img src="/img/posts/hello-arty/arty-board.jpg" alt="Arty Board" title="Arty Board"></p>
<p>In this part, we&rsquo;re interested in the four green LEDs (<strong><code>LD4-7</code></strong>), four sliding switches (<strong><code>SW0-3</code></strong>), and four buttons (<strong><code>BTN0-3</code></strong>). You can see these towards the bottom of the board in the above photo. The FPGA itself is the square chip in the middle of the board labelled &ldquo;Artix-7&rdquo;.</p>
<h2 id="hello-world-project">Hello World Project</h2>
<p>For our first SystemVerilog, we&rsquo;re going to use a switch to turn an LED off and on. We then extend this to cover multiple LEDs, switches, and buttons.</p>
<h3 id="creating-a-project">Creating a Project</h3>
<ol>
<li>Start Vivado.</li>
<li>Select &ldquo;Create Project&rdquo; under &ldquo;Quick Start&rdquo;.</li>
<li>Project name: <strong><code>hello-arty-1</code></strong> and make sure &ldquo;Create project subdirectory&rdquo; is selected.</li>
<li>Project Type: &ldquo;RTL Project&rdquo; and make sure &ldquo;Do not specify sources at this time&rdquo; is selected.</li>
<li>Default Part: Select &ldquo;Boards&rdquo; then choose &ldquo;Arty A7-35&rdquo;.<br>
If it&rsquo;s not on the list, you need to quit Vivado and install the <a href="https://reference.digilentinc.com/vivado/installing-vivado/start#installing_digilent_board_files">board files</a>.</li>
<li>Review the &ldquo;New Project Summary&rdquo; and hit &ldquo;Finish&rdquo;.</li>
</ol>
<p><em>If you&rsquo;re using the original Arty (without the A7) you should select &lsquo;Arty&rsquo; in step 5.</em></p>
<h3 id="hello-systemverilog">Hello SystemVerilog</h3>
<ol>
<li>In the top left of the Vivado window, under &ldquo;Project Manager&rdquo;, select &ldquo;Add Sources&rdquo;.</li>
<li>Choose &ldquo;Add or create design sources&rdquo; and click &ldquo;Next&rdquo;.</li>
<li>Select &ldquo;Create File&rdquo; in the middle of the dialog.</li>
<li>Make sure File type is set to &ldquo;SystemVerilog&rdquo; and name the file <code>top.sv</code> then click &ldquo;Finish&rdquo;.</li>
<li>In the &ldquo;Define Module&rdquo; dialog hit &ldquo;OK&rdquo; then click &ldquo;Yes&rdquo; when prompted.</li>
</ol>
<p>Replace the contents of the top module in <code>top.sv</code> with [<a href="https://github.com/projf/projf-explore/blob/master/hello-arty/A/top.sv">src</a>]:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog"><span style="color:#66d9ef">module</span> top (
    <span style="color:#66d9ef">input</span> <span style="color:#66d9ef">wire</span> <span style="color:#66d9ef">logic</span> sw,
    <span style="color:#66d9ef">output</span>     <span style="color:#66d9ef">logic</span> led
    );

    <span style="color:#66d9ef">always_comb</span> <span style="color:#66d9ef">begin</span>
        led <span style="color:#f92672">=</span> sw;
    <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">endmodule</span>
</code></pre></div><p>The first part of the module defines our inputs and outputs:</p>
<ul>
<li><strong><code>sw</code></strong> - one of the four slide switches</li>
<li><strong><code>led</code></strong> - one of the green LEDs (labelled <strong><code>LD4</code></strong> on the Arty board)</li>
</ul>
<p>The second part of the module is where we write our logic. In this case, we link <code>led</code> to <code>sw</code>: when the switch is on the LED is on, when the switch is off, the LED is off. Don&rsquo;t worry about the meaning of <code>always_comb</code> for now; we&rsquo;ll come back to that in part 2.</p>
<p>Save your file by hitting <strong><code>Ctrl-S</code></strong> or by using the save button at the top left of the editor window (yes, it still looks like a floppy disk).</p>
<p><em>ProTip: You can use <strong><code>Ctrl+/</code></strong> to (un)comment the current line in the Vivado editor window.</em></p>
<h3 id="constraints-file">Constraints File</h3>
<p>An FPGA is very flexible; you can connect many different types of inputs and outputs to the many hundreds of pins. Before synthesising our code, we need to tell Vivado how our Arty board is wired up. Vivado uses constraints to map an input or output, such as <strong><code>led</code></strong>, to the appropriate pin.</p>
<ol>
<li>In the top left of the Vivado window, select &ldquo;Add Sources&rdquo; under &ldquo;Project Manager&rdquo;.</li>
<li>Choose &ldquo;Add or create constraints&rdquo; and click &ldquo;Next&rdquo;.</li>
<li>Select &ldquo;Create File&rdquo; in the middle of the dialog.</li>
<li>Make sure File type is set to &ldquo;XDC&rdquo; and name the file <code>arty.xdc</code> then click &ldquo;Finish&rdquo;.</li>
</ol>
<p>Select <code>arty.xdc</code> in the editor window, add the following [<a href="https://github.com/projf/projf-explore/blob/master/hello-arty/A/arty.xdc">src</a>] content then save the file.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-tcl" data-lang="tcl"><span style="color:#75715e">## FPGA Configuration I/O Options
</span><span style="color:#75715e"></span>set_property CONFIG_VOLTAGE <span style="color:#ae81ff">3.3</span> <span style="color:#66d9ef">[</span>current_design<span style="color:#66d9ef">]</span>
set_property CFGBVS VCCO <span style="color:#66d9ef">[</span>current_design<span style="color:#66d9ef">]</span>

<span style="color:#75715e"># I/O Pins
</span><span style="color:#75715e"></span>set_property <span style="color:#f92672">-</span>dict <span style="color:#66d9ef">{</span>PACKAGE_PIN A8  IOSTANDARD LVCMOS33<span style="color:#66d9ef">}</span> <span style="color:#66d9ef">[</span>get_ports <span style="color:#66d9ef">{</span>sw<span style="color:#66d9ef">}];</span>
set_property <span style="color:#f92672">-</span>dict <span style="color:#66d9ef">{</span>PACKAGE_PIN H5  IOSTANDARD LVCMOS33<span style="color:#66d9ef">}</span> <span style="color:#66d9ef">[</span>get_ports <span style="color:#66d9ef">{</span>led<span style="color:#66d9ef">}];</span>
</code></pre></div><p><em>ProTip: These constraints are written in <a href="https://en.wikipedia.org/wiki/Tcl">Tcl</a>, which is used throughout Vivado.</em></p>
<h3 id="design-to-board">Design to Board</h3>
<p>To bring our design to life on the Arty board, we need to go through four steps:</p>
<ol>
<li><strong>Synthesis</strong> - converts the SystemVerilog into logic gates</li>
<li><strong>Implementation</strong> - optimises and lays out the logic design for the target FPGA</li>
<li><strong>Generate Bitstream</strong> - generates the FPGA bit file (gateware) from the implementation</li>
<li><strong>Program Device</strong> - loads the bit file onto the FPGA</li>
</ol>
<p>Even on a fast PC, this whole process can take a few minutes, so be patient.</p>
<ol>
<li>Click the green play button at the top of the Vivado screen.</li>
<li>Select &ldquo;Run Synthesis&rdquo;.<br>
If a &ldquo;Launch Runs&rdquo; dialog appears then just select &ldquo;OK&rdquo;.<br>
You&rsquo;ll see a message &ldquo;Running synth_design&rdquo; at the top-right of Vivado.</li>
<li>A dialog appears prompting you to &ldquo;Run Implementation&rdquo;.<br>
Click &ldquo;OK&rdquo; to start implementation.</li>
<li>A dialog appears saying &ldquo;Implementation successfully completed&rdquo;.<br>
Select &ldquo;Generate Bitstream&rdquo; and click &ldquo;OK&rdquo;.</li>
<li>A dialog appears saying &ldquo;Bitstream Generation successfully completed&rdquo;.<br>
Select &ldquo;Open Hardware Manager&rdquo; and click &ldquo;OK&rdquo;.</li>
</ol>
<p>If you accidentally close any step you can find commands to run the different stages on the left-hand side of the Vivado window.</p>
<h3 id="hardware-manager">Hardware Manager</h3>
<ol>
<li>Connect your Arty board to your PC using a micro USB cable.</li>
<li>At the bottom left of Vivado select &ldquo;Open Target&rdquo; under &ldquo;Open Hardware Manager&rdquo;.</li>
<li>Choose &ldquo;Auto Connect&rdquo; from the menu. If this fails, try again, it can be temperamental.</li>
<li>Select &ldquo;Program Device&rdquo; under &ldquo;Open Hardware Manager&rdquo;.</li>
<li>There should be one option &ldquo;xc7a35t_0&rdquo;; this is your Arty board.</li>
<li>Browse to your bitstream file <code>hello-arty-1/hello-arty-1.runs/impl_1/top.bit</code>.</li>
<li>Click &ldquo;Program&rdquo;.</li>
</ol>
<p><em>If you&rsquo;re on Linux and hardware manager never connects then you may have forgotten to <a href="#requirements">install the cable drivers</a>.</em></p>
<h3 id="hello-led">Hello LED</h3>
<p>Slide the switch <strong><code>SW0</code></strong> on and off on your board to control green LED <strong><code>LD4</code></strong>.</p>
<p><img src="/img/posts/hello-arty/hello-led.jpg" alt="LED on!" title="Arty board showing SW0 and LD4 on."></p>
<p>This functionality isn&rsquo;t anything you couldn&rsquo;t trivially achieve with a microcontroller. However, it&rsquo;s worth pausing to think about what you&rsquo;ve done here. You&rsquo;ve created a simple circuit board within the FPGA. There is no CPU running code here: it&rsquo;s as if you&rsquo;d wired up the switch to the LED on a breadboard.</p>
<h2 id="moar-switches-moar-leds">Moar Switches, Moar LEDs!</h2>
<p>You didn&rsquo;t buy an FPGA to emulate a single wire on a breadboard; let&rsquo;s extend our design so that one switch can control two LEDs. Granted you didn&rsquo;t buy an FPGA board to do that either, but it does at least involve some logic!</p>
<p><em>If you&rsquo;re still in Hardware Manager; you can get back to your Verilog source code by selecting &ldquo;Project Manager&rdquo; at the top left of the Vivado window.</em></p>
<p>Replace the existing top module in <code>top.sv</code> with the following [<a href="https://github.com/projf/projf-explore/blob/master/hello-arty/B/top.sv">src</a>]:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog"><span style="color:#66d9ef">module</span> top (
    <span style="color:#66d9ef">input</span> <span style="color:#66d9ef">wire</span> <span style="color:#66d9ef">logic</span> [<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] sw,
    <span style="color:#66d9ef">output</span>     <span style="color:#66d9ef">logic</span> [<span style="color:#ae81ff">3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] led
    );
  
    <span style="color:#66d9ef">always_comb</span> <span style="color:#66d9ef">begin</span>
        <span style="color:#66d9ef">if</span> (sw[<span style="color:#ae81ff">0</span>]) <span style="color:#66d9ef">begin</span>
            led[<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#ae81ff">&#39;b11</span>;
        <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">begin</span>
            led[<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#ae81ff">&#39;b00</span>;
        <span style="color:#66d9ef">end</span>

        <span style="color:#66d9ef">if</span> (sw[<span style="color:#ae81ff">1</span>]) <span style="color:#66d9ef">begin</span>
            led[<span style="color:#ae81ff">3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#ae81ff">&#39;b11</span>;
        <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">begin</span>
            led[<span style="color:#ae81ff">3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#ae81ff">&#39;b00</span>;
        <span style="color:#66d9ef">end</span>
    <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">endmodule</span>
</code></pre></div><p><strong><code>2'b</code></strong> defines a 2-bit binary literal: we have two LEDs each expecting a signal, so a two-bit value is appropriate here. You can also see the notation for referring to multiple LEDs: <strong><code>led[1:0]</code></strong> includes both <strong><code>led[0]</code></strong> and <strong><code>led[1]</code></strong>.</p>
<p>We&rsquo;re added a switch and three LEDs to our design, but we haven&rsquo;t defined them in our constraints file; Vivado won&rsquo;t know what to connect them to. Open up <code>arty.xdc</code> and replace it with [<a href="https://github.com/projf/projf-explore/blob/master/hello-arty/B/arty.xdc">src</a>]:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-tcl" data-lang="tcl"><span style="color:#75715e">## FPGA Configuration I/O Options
</span><span style="color:#75715e"></span>set_property CONFIG_VOLTAGE <span style="color:#ae81ff">3.3</span> <span style="color:#66d9ef">[</span>current_design<span style="color:#66d9ef">]</span>
set_property CFGBVS VCCO <span style="color:#66d9ef">[</span>current_design<span style="color:#66d9ef">]</span>

<span style="color:#75715e">## Slide Switches
</span><span style="color:#75715e"></span>set_property <span style="color:#f92672">-</span>dict <span style="color:#66d9ef">{</span>PACKAGE_PIN A8  IOSTANDARD LVCMOS33<span style="color:#66d9ef">}</span> <span style="color:#66d9ef">[</span>get_ports <span style="color:#66d9ef">{</span>sw<span style="color:#66d9ef">[</span>0<span style="color:#66d9ef">]}];</span>
set_property <span style="color:#f92672">-</span>dict <span style="color:#66d9ef">{</span>PACKAGE_PIN C11 IOSTANDARD LVCMOS33<span style="color:#66d9ef">}</span> <span style="color:#66d9ef">[</span>get_ports <span style="color:#66d9ef">{</span>sw<span style="color:#66d9ef">[</span>1<span style="color:#66d9ef">]}];</span>

<span style="color:#75715e">## LEDs
</span><span style="color:#75715e"></span>set_property <span style="color:#f92672">-</span>dict <span style="color:#66d9ef">{</span>PACKAGE_PIN H5  IOSTANDARD LVCMOS33<span style="color:#66d9ef">}</span> <span style="color:#66d9ef">[</span>get_ports <span style="color:#66d9ef">{</span>led<span style="color:#66d9ef">[</span>0<span style="color:#66d9ef">]}];</span>
set_property <span style="color:#f92672">-</span>dict <span style="color:#66d9ef">{</span>PACKAGE_PIN J5  IOSTANDARD LVCMOS33<span style="color:#66d9ef">}</span> <span style="color:#66d9ef">[</span>get_ports <span style="color:#66d9ef">{</span>led<span style="color:#66d9ef">[</span>1<span style="color:#66d9ef">]}];</span>
set_property <span style="color:#f92672">-</span>dict <span style="color:#66d9ef">{</span>PACKAGE_PIN T9  IOSTANDARD LVCMOS33<span style="color:#66d9ef">}</span> <span style="color:#66d9ef">[</span>get_ports <span style="color:#66d9ef">{</span>led<span style="color:#66d9ef">[</span>2<span style="color:#66d9ef">]}];</span>
set_property <span style="color:#f92672">-</span>dict <span style="color:#66d9ef">{</span>PACKAGE_PIN T10 IOSTANDARD LVCMOS33<span style="color:#66d9ef">}</span> <span style="color:#66d9ef">[</span>get_ports <span style="color:#66d9ef">{</span>led<span style="color:#66d9ef">[</span>3<span style="color:#66d9ef">]}];</span>
</code></pre></div><p>Rerun synthesis, implementation, bitstream generation, and program the board as before. You should be able to control two LEDs with each of the first two slide switches.</p>
<h2 id="conditional-love">Conditional Love</h2>
<p>Those if blocks can get annoying fast, plus bad things happen if you don&rsquo;t provide a value for all possible outcomes (latches: yuuurgh). Verilog has an answer for this with the every-handy <strong>conditional operator</strong> <code>condition ? value_if_true : value_if_false;</code></p>
<p>The easiest way to understand it is to see it in action; replace top.sv with the following [<a href="https://github.com/projf/projf-explore/blob/master/hello-arty/C/top.sv">src</a>]:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog"><span style="color:#66d9ef">module</span> top (
    <span style="color:#66d9ef">input</span> <span style="color:#66d9ef">wire</span> <span style="color:#66d9ef">logic</span> [<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] sw,
    <span style="color:#66d9ef">output</span>     <span style="color:#66d9ef">logic</span> [<span style="color:#ae81ff">3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] led
    );
  
    <span style="color:#66d9ef">always_comb</span> <span style="color:#66d9ef">begin</span>
        led[<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> sw[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">?</span> <span style="color:#ae81ff">2</span><span style="color:#ae81ff">&#39;b11</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">2</span><span style="color:#ae81ff">&#39;b00</span>;
        led[<span style="color:#ae81ff">3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> sw[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">?</span> <span style="color:#ae81ff">2</span><span style="color:#ae81ff">&#39;b11</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">2</span><span style="color:#ae81ff">&#39;b00</span>;
    <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">endmodule</span>
</code></pre></div><p>Go through the usual rigmarole of synthesis, implementation, bitstream generation, and programming your board. It should work as before, but I think you&rsquo;ll agree the conditional operator makes this design simpler to write and understand.</p>
<h2 id="buttons-too">Buttons Too</h2>
<p>We also have push buttons on the board; we can easily add these to our design. Replace your top module with the following [<a href="https://github.com/projf/projf-explore/blob/master/hello-arty/D/top.sv">src</a>]:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog"><span style="color:#66d9ef">module</span> top (
    <span style="color:#66d9ef">input</span> <span style="color:#66d9ef">wire</span> <span style="color:#66d9ef">logic</span> [<span style="color:#ae81ff">3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] sw,
    <span style="color:#66d9ef">input</span> <span style="color:#66d9ef">wire</span> <span style="color:#66d9ef">logic</span> [<span style="color:#ae81ff">3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] btn,
    <span style="color:#66d9ef">output</span>     <span style="color:#66d9ef">logic</span> [<span style="color:#ae81ff">3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] led
    );

    <span style="color:#66d9ef">always_comb</span> <span style="color:#66d9ef">begin</span>
        <span style="color:#66d9ef">if</span> (sw[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">begin</span>
            led[<span style="color:#ae81ff">3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span><span style="color:#ae81ff">&#39;b0000</span>;
        <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">begin</span>
            led[<span style="color:#ae81ff">3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> btn[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">?</span> <span style="color:#ae81ff">4</span><span style="color:#ae81ff">&#39;b1001</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">4</span><span style="color:#ae81ff">&#39;b0110</span>;
        <span style="color:#66d9ef">end</span>
    <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">endmodule</span>
</code></pre></div><p>We don&rsquo;t have the push buttons in our constraints file, so we&rsquo;ll add them as well as the other two slide switches [<a href="https://github.com/projf/projf-explore/blob/master/hello-arty/D/arty.xdc">src</a>]:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-tcl" data-lang="tcl"><span style="color:#75715e">## FPGA Configuration I/O Options
</span><span style="color:#75715e"></span>set_property CONFIG_VOLTAGE <span style="color:#ae81ff">3.3</span> <span style="color:#66d9ef">[</span>current_design<span style="color:#66d9ef">]</span>
set_property CFGBVS VCCO <span style="color:#66d9ef">[</span>current_design<span style="color:#66d9ef">]</span>

<span style="color:#75715e">## Slide Switches
</span><span style="color:#75715e"></span>set_property <span style="color:#f92672">-</span>dict <span style="color:#66d9ef">{</span>PACKAGE_PIN A8  IOSTANDARD LVCMOS33<span style="color:#66d9ef">}</span> <span style="color:#66d9ef">[</span>get_ports <span style="color:#66d9ef">{</span>sw<span style="color:#66d9ef">[</span>0<span style="color:#66d9ef">]}];</span>
set_property <span style="color:#f92672">-</span>dict <span style="color:#66d9ef">{</span>PACKAGE_PIN C11 IOSTANDARD LVCMOS33<span style="color:#66d9ef">}</span> <span style="color:#66d9ef">[</span>get_ports <span style="color:#66d9ef">{</span>sw<span style="color:#66d9ef">[</span>1<span style="color:#66d9ef">]}];</span>
set_property <span style="color:#f92672">-</span>dict <span style="color:#66d9ef">{</span>PACKAGE_PIN C10 IOSTANDARD LVCMOS33<span style="color:#66d9ef">}</span> <span style="color:#66d9ef">[</span>get_ports <span style="color:#66d9ef">{</span>sw<span style="color:#66d9ef">[</span>2<span style="color:#66d9ef">]}];</span>
set_property <span style="color:#f92672">-</span>dict <span style="color:#66d9ef">{</span>PACKAGE_PIN A10 IOSTANDARD LVCMOS33<span style="color:#66d9ef">}</span> <span style="color:#66d9ef">[</span>get_ports <span style="color:#66d9ef">{</span>sw<span style="color:#66d9ef">[</span>3<span style="color:#66d9ef">]}];</span>

<span style="color:#75715e">## Buttons
</span><span style="color:#75715e"></span>set_property <span style="color:#f92672">-</span>dict <span style="color:#66d9ef">{</span>PACKAGE_PIN D9  IOSTANDARD LVCMOS33<span style="color:#66d9ef">}</span> <span style="color:#66d9ef">[</span>get_ports <span style="color:#66d9ef">{</span>btn<span style="color:#66d9ef">[</span>0<span style="color:#66d9ef">]}];</span>
set_property <span style="color:#f92672">-</span>dict <span style="color:#66d9ef">{</span>PACKAGE_PIN C9  IOSTANDARD LVCMOS33<span style="color:#66d9ef">}</span> <span style="color:#66d9ef">[</span>get_ports <span style="color:#66d9ef">{</span>btn<span style="color:#66d9ef">[</span>1<span style="color:#66d9ef">]}];</span>
set_property <span style="color:#f92672">-</span>dict <span style="color:#66d9ef">{</span>PACKAGE_PIN B9  IOSTANDARD LVCMOS33<span style="color:#66d9ef">}</span> <span style="color:#66d9ef">[</span>get_ports <span style="color:#66d9ef">{</span>btn<span style="color:#66d9ef">[</span>2<span style="color:#66d9ef">]}];</span>
set_property <span style="color:#f92672">-</span>dict <span style="color:#66d9ef">{</span>PACKAGE_PIN B8  IOSTANDARD LVCMOS33<span style="color:#66d9ef">}</span> <span style="color:#66d9ef">[</span>get_ports <span style="color:#66d9ef">{</span>btn<span style="color:#66d9ef">[</span>3<span style="color:#66d9ef">]}];</span>

<span style="color:#75715e">## LEDs
</span><span style="color:#75715e"></span>set_property <span style="color:#f92672">-</span>dict <span style="color:#66d9ef">{</span>PACKAGE_PIN H5  IOSTANDARD LVCMOS33<span style="color:#66d9ef">}</span> <span style="color:#66d9ef">[</span>get_ports <span style="color:#66d9ef">{</span>led<span style="color:#66d9ef">[</span>0<span style="color:#66d9ef">]}];</span>
set_property <span style="color:#f92672">-</span>dict <span style="color:#66d9ef">{</span>PACKAGE_PIN J5  IOSTANDARD LVCMOS33<span style="color:#66d9ef">}</span> <span style="color:#66d9ef">[</span>get_ports <span style="color:#66d9ef">{</span>led<span style="color:#66d9ef">[</span>1<span style="color:#66d9ef">]}];</span>
set_property <span style="color:#f92672">-</span>dict <span style="color:#66d9ef">{</span>PACKAGE_PIN T9  IOSTANDARD LVCMOS33<span style="color:#66d9ef">}</span> <span style="color:#66d9ef">[</span>get_ports <span style="color:#66d9ef">{</span>led<span style="color:#66d9ef">[</span>2<span style="color:#66d9ef">]}];</span>
set_property <span style="color:#f92672">-</span>dict <span style="color:#66d9ef">{</span>PACKAGE_PIN T10 IOSTANDARD LVCMOS33<span style="color:#66d9ef">}</span> <span style="color:#66d9ef">[</span>get_ports <span style="color:#66d9ef">{</span>led<span style="color:#66d9ef">[</span>3<span style="color:#66d9ef">]}];</span>
</code></pre></div><p>Rerun synthesis, implementation, bitstream generation, and program the board as before.</p>
<p><strong><code>SW0</code></strong> controls all LEDs, while <strong><code>BTN0</code></strong> selects two different patterns of lights.</p>
<h2 id="explore">Explore</h2>
<p>Try your own combinations of switches, buttons, and LEDs. Make sure your values are the same width as your inputs and outputs, for example, three bits for three LEDs: <code>led[3:1] = 3'b101;</code></p>
<h2 id="whats-next">What&rsquo;s Next?</h2>
<p>In the next part of this series (coming soon), we&rsquo;ll look at clocks, counting, and pulse width modulation.</p>

      
      <div class="related">
</div>
      
    </div>
    
  </div>
</section>

    <script src="/js/copycode.js"></script>



<section class="section">
  <div class="container has-text-centered">
    <p>©2020 Will Green, Project F</p>
    
  </div>
</section>



<script>
(function(f, a, t, h, o, m){
a[h]=a[h]||function(){
(a[h].q=a[h].q||[]).push(arguments)
};
o=f.createElement('script'),
m=f.getElementsByTagName('script')[0];
o.async=1; o.src=t; o.id='fathom-script';
m.parentNode.insertBefore(o,m)
})(document, window, 'https://cdn.usefathom.com/tracker.js', 'fathom');
fathom('set', 'siteId', 'EVCGKVDN');
fathom('trackPageview');
</script>


</body>
</html>

